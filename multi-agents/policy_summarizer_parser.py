@tool def parse_json_output(llm_output: str) -> dict: """ Convert LLM output into a valid Python dict. Ensures JSON normalization and handles minor model mistakes. """ if not llm_output: return {"error": "empty_output", "raw_output": llm_output} # Remove markdown fences text = re.sub(r"
[a-zA-Z0-9]*", "", llm_output).strip()

    # Normalize quotes
    text = text.replace("None", "null")
    text = text.replace("True", "true").replace("False", "false")

    # Convert Python dict notation to JSON
    # Replace ONLY outer-level single quotes, not apostrophes inside words
    text = re.sub(r"'([^']+)':", r'"\1":', text)
    text = re.sub(r": '([^']+)'", r': "\1"', text)

    # Ensure chunks are an array, not concatenated objects
    # Fix accidental }{ concatenations
    text = text.replace("}\n{", "}, {")

    try:
        return json.loads(text)
    except Exception as e:
        return {
            "error": str(e),
            "raw_output": llm_output,
            "cleaned_text_attempt": text
        }

E a saída deste script:

[
0:
{
"system_metrics":
{
"duration":
0.00049
}
"output":
{
"error":
"Invalid \\escape: line 13 column 1589 (char 1864)"
"raw_output":
"{\n \"intent\": \"candidate_position_query\",\n \"entities\": {\n \"candidate_name\": [\n \"Eduardo da Costa Paes\"\n ],\n \"policy_topic\": null,\n \"question_type\": \"position_inquiry\"\n },\n \"original_query\": \"Qual a proposta do Eduardo Paes?\",\n \"retrieved_chunks\": [\n {\n \"content\": \"Title: 4. EDUARDO DA COSTA PAES\\n\\n4. EDUARDO DA COSTA PAES\\nNome Completo: EDUARDO DA COSTA PAES\\n\\nData de Nascimento: 14/11/1969\\n\\nGênero: Masculino\\n\\nCor/Raça: Branca\\n\\nEtnia Indígena: Não Informado\\n\\nQuilombola: Não\\n\\nEstado Civil: Casado(a)\\n\\nGrau de Instrução: Superior Completo\\n\\nOcupação: Prefeito\\n\\nNacionalidade: Brasileira Nata / RJ-Rio De Janeiro\\n\\nReeleição: Sim\\n\\nColigação: É o Rio seguindo em frente\\n\\nComposição da Coligação: PODE / PRD / DC / AGIR / SOLIDARIEDADE / AVANTE / PSB / PDT / Federação BRASIL DA ESPERANÇA - FE BRASIL(PT/PC do B/PV) / PSD\\n\\nLimite de Gastos (1º Turno): R$ 29.381.712,71\\n\\nLimite de Gastos (2º Turno): R$ 11.752.685,09\\n\\nURL: https://divulgacandcontas.tse.jus.br/divulga/#/candidato/SUDESTE/RJ/2045202024/190002135253/2024/60011\\n\\nData da Coleta: 2025-11-18T22:49:51.971744\\n\\nTexto para Busca: EDUARDO DA COSTA PAES É o Rio seguindo em frente Prefeito\\n\\nNúmero de Ordem: 4\\n\\n\\n\\n============================================================\\nPÁGINA 1 ============================================================\\n\\nColigação É o Rio seguindoem frente.\\nPSD, Solidariedade, Podemos, Avante, Agir, PDT, PSB, PRD, DC e Federação PT/PV/PCdoB\\nVERSÃO PRELIMINAR 1.0\\nDO PROGRAMA DE GOVERNO\\nEDUARDO PAES\\nPREFEITO DO RIO 2025 - 2028\\n\\n============================================================\\nPÁGINA 2 ============================================================\\n\\nOS 8 OBJETIVOS CENTRAIS\\nDO PRÓXIMO GOVERNO\\nEDUARDO PAES\\nSeguir ampliando a qualidade dos serviços públicos prestados no município, sobretu\\xad do nas áreas da Saúde, Educação e Transportes, garantindo o bom funcionamento da infraestrutura e dos equipamentos já existentes;\\nSeguir reduzindo a grande diferença de qualidade entre a educação pública e a educação privada na nossa cidade, a fim de garantir maior igualdade de oportunidades para todos jovens e crianças cariocas - independentemente da classe social de suas famílias e se vivem em áreas urbanas ou em comunidades;\\nSeguir capacitando o carioca para o mercado de trabalho e atraindo cada vez mais emprego e renda para a nossa cidade por meio de um forte investimento no turismo, na revitalização econômica da região portuária e no estabelecimento de parcerias com o setor privado e com outras esferas de governo - colocando sempre o interesse público do Rio de Janeiro acima de toda e qualquer divergência política ou ideológica;\\nManter a responsabilidade com a gestão financeira do município e a eficiência da máquina da Prefeitura, garantindo a valorização dos profissionais do serviço público, o pagamento dos salários em dia e a premiação por desempenho, conforme o Programa\\nAcordo de Resultados;\\nReduzir os alarmantes níveis de pobreza e indigência na nossa cidade por meio da ampliação dos recursos do programa Cartão Família Carioca, Seguir em Frente,\\nMorar Carioca e da implantação de novos projetos voltados para garantir a segurança alimentar dos cariocas;\\nSeguir ampliando os investimentos sociais e infraestruturantes da Prefeitura, sobretudo nos bairros da Zona Norte, da Zona Oeste e nas comunidades e favelas da nossa cidade – sempre visando melhorar a qualidade dos serviços públicos, recuperar a infraestrutura já existente e criar frentes de trabalho para gerar emprego e renda para a nossa população mais economicamente vulnerável;\\nCriar um amplo programa de conscientização para a cidadania nas escolas e nos espaços coletivos (praças, parques e equipamentos culturais e esportivos da cidade) a fim de melhorar o respeito do carioca em relação ao\",\n \"source\": \"4. EDUARDO DA COSTA PAES\",\n \"relevance_score\": 20.429886,\n \"page_number\": \"N/A\"\n } (truncated, 12.0K)
"cleaned_text_attempt":
"{\n \"intent\": \"candidate_position_query\",\n \"entities\": {\n \"candidate_name\": [\n \"Eduardo da Costa Paes\"\n ],\n \"policy_topic\": null,\n \"question_type\": \"position_inquiry\"\n },\n \"original_query\": \"Qual a proposta do Eduardo Paes?\",\n \"retrieved_chunks\": [\n {\n \"content\": \"Title: 4. EDUARDO DA COSTA PAES\\n\\n4. EDUARDO DA COSTA PAES\\nNome Completo: EDUARDO DA COSTA PAES\\n\\nData de Nascimento: 14/11/1969\\n\\nGênero: Masculino\\n\\nCor/Raça: Branca\\n\\nEtnia Indígena: Não Informado\\n\\nQuilombola: Não\\n\\nEstado Civil: Casado(a)\\n\\nGrau de Instrução: Superior Completo\\n\\nOcupação: Prefeito\\n\\nNacionalidade: Brasileira Nata / RJ-Rio De Janeiro\\n\\nReeleição: Sim\\n\\nColigação: É o Rio seguindo em frente\\n\\nComposição da Coligação: PODE / PRD / DC / AGIR / SOLIDARIEDADE / AVANTE / PSB / PDT / Federação BRASIL DA ESPERANÇA - FE BRASIL(PT/PC do B/PV) / PSD\\n\\nLimite de Gastos (1º Turno): R$ 29.381.712,71\\n\\nLimite de Gastos (2º Turno): R$ 11.752.685,09\\n\\nURL: https://divulgacandcontas.tse.jus.br/divulga/#/candidato/SUDESTE/RJ/2045202024/190002135253/2024/60011\\n\\nData da Coleta: 2025-11-18T22:49:51.971744\\n\\nTexto para Busca: EDUARDO DA COSTA PAES É o Rio seguindo em frente Prefeito\\n\\nNúmero de Ordem: 4\\n\\n\\n\\n============================================================\\nPÁGINA 1 ============================================================\\n\\nColigação É o Rio seguindoem frente.\\nPSD, Solidariedade, Podemos, Avante, Agir, PDT, PSB, PRD, DC e Federação PT/PV/PCdoB\\nVERSÃO PRELIMINAR 1.0\\nDO PROGRAMA DE GOVERNO\\nEDUARDO PAES\\nPREFEITO DO RIO 2025 - 2028\\n\\n============================================================\\nPÁGINA 2 ============================================================\\n\\nOS 8 OBJETIVOS CENTRAIS\\nDO PRÓXIMO GOVERNO\\nEDUARDO PAES\\nSeguir ampliando a qualidade dos serviços públicos prestados no município, sobretu\\xad do nas áreas da Saúde, Educação e Transportes, garantindo o bom funcionamento da infraestrutura e dos equipamentos já existentes;\\nSeguir reduzindo a grande diferença de qualidade entre a educação pública e a educação privada na nossa cidade, a fim de garantir maior igualdade de oportunidades para todos jovens e crianças cariocas - independentemente da classe social de suas famílias e se vivem em áreas urbanas ou em comunidades;\\nSeguir capacitando o carioca para o mercado de trabalho e atraindo cada vez mais emprego e renda para a nossa cidade por meio de um forte investimento no turismo, na revitalização econômica da região portuária e no estabelecimento de parcerias com o setor privado e com outras esferas de governo - colocando sempre o interesse público do Rio de Janeiro acima de toda e qualquer divergência política ou ideológica;\\nManter a responsabilidade com a gestão financeira do município e a eficiência da máquina da Prefeitura, garantindo a valorização dos profissionais do serviço público, o pagamento dos salários em dia e a premiação por desempenho, conforme o Programa\\nAcordo de Resultados;\\nReduzir os alarmantes níveis de pobreza e indigência na nossa cidade por meio da ampliação dos recursos do programa Cartão Família Carioca, Seguir em Frente,\\nMorar Carioca e da implantação de novos projetos voltados para garantir a segurança alimentar dos cariocas;\\nSeguir ampliando os investimentos sociais e infraestruturantes da Prefeitura, sobretudo nos bairros da Zona Norte, da Zona Oeste e nas comunidades e favelas da nossa cidade – sempre visando melhorar a qualidade dos serviços públicos, recuperar a infraestrutura já existente e criar frentes de trabalho para gerar emprego e renda para a nossa população mais economicamente vulnerável;\\nCriar um amplo programa de conscientização para a cidadania nas escolas e nos espaços coletivos (praças, parques e equipamentos culturais e esportivos da cidade) a fim de melhorar o respeito do carioca em relação ao\",\n \"source\": \"4. EDUARDO DA COSTA PAES\",\n \"relevance_score\": 20.429886,\n \"page_number\": \"N/A\"\n } (truncated, 12.0K)
}
}
]